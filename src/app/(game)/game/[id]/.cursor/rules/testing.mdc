---
globs: *.test.tsx,*test.ts
alwaysApply: false
---

# TESTING RULES FOR GAME-ROOM PAGE COMPONENTS AND HOOKS

## Rules the AI must follow

-   Use entity generators from `../__tests__/game-state-store.test-helpers`
-   Wrap components/hooks with `GameRoomFakeProviderWrapper` from `../__mocks__`
-   When component relies on store instance, create it via `createGameStateStore(...)` from `../../../model` and pass through wrapper
-   When API calls are used, inject them via `apiProps` into `GameRoomFakeProviderWrapper`

## Patterns

### Good imports

```typescript
import { test, describe, expect, vi, beforeEach, afterEach } from "vitest";
import { act, render, within, waitFor } from "@/test/utilities";
import { axe } from "jest-axe";
import { GameRoomFakeProviderWrapper } from "../__mocks__";
import {
	generateGame,
	generateParticipant,
	generateTicket,
} from "../__tests__/game-state-store.test-helpers";
```

### Example: API mock injection via wrapper

```typescript
const createTicket = vi.fn(async (gameId: string, data: CreateTicketForGameRequest) => {
	return { ok: true, data: generateTicket({ ...data }) };
});

function renderComponent() {
	return render(<TicketsPanel />, {
		wrapper: GameRoomFakeProviderWrapper({
			apiProps: { game: { ticket: { createTicket } } },
			gameStateProps: {
				game: generateGame({
					id: "test-game-id",
					tickets: [
						generateTicket({ id: "ticket-id-1", title: "Ticket Name" }),
					],
				}),
				currentParticipant: generateParticipant({}),
			},
		}),
	});
}
```

### Example: Store-backed component test

```typescript
import { createGameStateStore, GameManagementTab } from "../../../model";

const gameStateStore = createGameStateStore({
	game: generateGame({}),
	currentParticipant: generateParticipant({}),
});

function renderWithStore() {
	return render(<GameManagementBar />, {
		wrapper: GameRoomFakeProviderWrapper({ gameStateStore }),
	});
}

test("changes active tab", async () => {
	const { user, getAllByRole } = renderWithStore();
	const buttons = getAllByRole("button");
	await user.click(buttons[0]);
	expect(gameStateStore.getState().activeTab).toBe(GameManagementTab.TaskList);
});
```
